const { scrapeJD } = require('./lib/scraper'); const { closeBrowser } = require('./lib/browser'); async function test() { console.log('--- Testing lib/scraper.js (Browser Pooling & SSRF) ---'); try { console.log('Testing SSRF prevention...'); await scrapeJD('file:///etc/passwd'); console.error('FAIL: Scraper allowed file://'); process.exit(1); } catch (err) { console.log('OK: Blocked invalid protocol'); } try { console.log('Testing real scrape (example.com)...'); const result = await scrapeJD('https://example.com'); if (result && result.description && result.description.toLowerCase().includes('example')) { console.log('OK: Scraper fetched content.'); } else { throw new Error('Content mismatch or missing description'); } } catch (err) { console.error('FAIL: Real scrape:', err.message); process.exit(1); } await closeBrowser(); console.log('Scraper tests passed!'); } test();